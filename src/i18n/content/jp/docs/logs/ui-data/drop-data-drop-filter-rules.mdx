---
title: ドロップフィルタールールによるデータのドロップ
tags:
  - Logs
  - Log management
  - UI and data
metaDescription: Data retention information for New Relic's log management and logs in context.
translationType: machine
---

ログイベントデータがNew Relicに送信された後、そのデータはNRDBデータベースに保存されるか、ドロップ（廃棄）されるかのどちらかになります。ドロップフィルタールールによって、ログイベントとイベント属性の両方をドロップすることができます。

ドロップフィルタのルールは、このドキュメントで説明している Logs UI を使用して管理できます。また、GraphQL 形式の API エクスプローラーである [NerdGraph](/docs/accounts/accounts/data-management/drop-data-using-nerdgraph) もご利用いただけます。

## 節約、セキュリティ、スピード [#why-it-matters]

ドロップフィルターのルールは、いくつかの重要な目標を達成するのに役立ちます。

* お客様のアカウントに関連するログのみを保存することで、コストを削減できます。
* 個人を特定できる情報（PII）を削除することで、プライバシーとセキュリティを保護します。
* 無関係なイベントや属性を削除して、ノイズを減らす。

<Callout variant="caution">
  データをドロップするかどうかは慎重に判断してください。ドロップしたデータは復元できません。この機能を使用する前に、 [データをドロップする際の責任と考慮事項を確認してください。](#caution) 。
</Callout>

## ドロップフィルタールールの仕組み [#how-it-works]

ドロップ・フィルタ・ルールは、クエリに基づいてデータを照合します。トリガされると、ドロップ・フィルタ・ルールは、NRDBに書き込まれる前に、インジェスト・パイプラインから一致するデータを削除します。

これにより、お客様のドメインから転送されるログと、New Relicが収集するデータとの間に、明確な境界線ができます。ドロップフィルターのルールによって削除されたデータはバックエンドに到達しないため、クエリをかけることができません：データは消えてしまい、復元できません。

![New Relic Logs - アーキテクチャ - ドロップフィルター](./images/ingest-pipeline.png "New Relic Logs - アーキテクチャ - ドロップフィルター")

<figcaption>
  インジェスチョンの過程で、顧客のログデータはNew Relicのデータベースに保存される前に、解析、変換、削除されることがあります。
</figcaption>

## データを落とす際の注意点 [#caution]

ドロップルールを作成する際には、ルールが設定した条件を満たすデータを正確に識別し、廃棄することに責任を負います。また、ルールの監視だけでなく、New Relic に開示したデータの監視にも責任があります。

New Relic は、この機能によってお客様が抱えるデータ開示の懸念を完全に解決できることを保証するものではありません。New Relic は、あなたが開発したルールがどれだけ効果的であるかをレビューしたり監視したりしません。

機密データに関するルールを作成すると、どのような種類のデータを保持しているのか、データやシステムの形式（例えば、電子メールアドレスや特定のクレジットカード番号を参照することなど）などの情報が漏れてしまいます。関連するロールベースのアクセス制御権限を持つすべてのユーザーは、作成したルールのすべての情報を表示および編集できます。

## ドロップフィルタールールの作成 [#create]

ドロップフィルターを作成・編集するには、New Relic で [admin 権限](/docs/accounts/accounts-billing/new-relic-one-pricing-users/users-roles#user-group) を持っているか、 **Insights> NRQL Drop Rules** の作成・編集権限を持つロールのメンバーである必要があります。

ドロップフィルターのルールが有効になると、その時点以降に取り込まれたすべてのログイベントに適用されます。ルールは過去にさかのぼって適用されません。ルールを作成する前に収集されたログは、そのルールではフィルタリングされません。

![ログドロップフィルター](./images/log-drop-filter-create.png "ログドロップフィルター")

<figcaption>
  ドロップしたいデータを含むログのセットをフィルタリングまたはクエリします。次に、Logs UI の左ナビにある **Manage Data** から、 **Create drop filter** をクリックします。
</figcaption>

新しいドロップフィルタールールを作成するには、新規または既存の [ログクエリ](/docs/logs/new-relic-logs/ui-data/query-syntax-logs) を使用できます。

1. **[one.newrelic.com](https://one.newrelic.com) > Logs** にアクセスしてください。
2. ドロップするデータを含む特定のログセットにフィルタリングまたはクエリを実行します。
3. クエリがアクティブになったら、Logs UI の左ナビにある **Manage Data** から、 **Create drop filter** をクリックします。
4. **推奨：** ドロップルールのデフォルト名を意味のある名前に変更します。
5. [](#drop-events)クエリにマッチしたログイベント 全体をドロップするか、マッチしたイベントの属性 特定のサブセットのみをドロップするかを選択します。[](#drop-attributes)
6. [* このドロップルールが適用されるログパーティションを確認します。* ドロップフィルターのルールを保存します。](#drop-attributes)

## [NerdGraph APIでドロップフィルタのルールを管理 [#nerdgraph]](#drop-attributes)

[ドロップフィルターのルールをプログラムで管理したい場合は、GraphQL形式のAPIであるNerdGraphを ](#drop-attributes)[api.newrelic.com/graphiql](https://api.newrelic.com/graphiql) に用意しています。詳細については、 [NerdGraph チュートリアル](/docs/accounts/accounts/data-management/drop-data-using-nerdgraph) を参照して、ドロップフィルタのルールを作成、照会、削除してください。

## ドロップフィルタールールの種類 [#types]

ドロップフィルターのUIでは、クエリに基づいてログをドロップするか、特定の属性に基づいてドロップするかを選択するよう求められます。

### ログイベントの削除 [#drop-events]

ドロップフィルタールールのデフォルトタイプは、ログをドロップすることです。このオプションは、フィルタまたはクエリにマッチするログイベント全体をドロップします。ルールを作成する際には、ドロップすべきログデータのみにマッチする特定のクエリを提供するようにしてください。

当社のドロップフィルタプロセスでは、マッチングクエリに値がないドロップフィルタルールを作成することはできません。これにより、不適切に作成されたルールがすべてのログデータをドロップすることを防ぎます。

### ドロップ属性 [#drop-attributes]

クエリにマッチしたログイベントにドロップする属性を指定できます。少なくとも 1 つ以上の属性を選択する必要があります。選択された属性はすべてドロップされ、残りの属性はすべて維持されてNRDBに保存されます。

<Callout variant="tip">
  貴重なモニタリングデータを失うことなく、個人識別情報（PII）やその他の機密属性を含む可能性のあるフィールドを削除するには、この方法をお勧めします。
</Callout>

## ドロップフィルタールールの表示・削除 [#drop-rules-delete]

![表示ログのドロップフィルター](./images/log-drop-filter042721.png "表示ログのドロップフィルター")

ドロップフィルターのルールを表示または削除するには

1. **[one.newrelic.com](https://one.newrelic.com) > Logs** にアクセスしてください。

2. Logs UI の左ナビにある **Manage Data** から、 **Drop filters** をクリックします。

3. **delete**

   <Icon name="fe-trash-2"/>

   削除したいドロップフィルタールールの横にあるアイコンをクリックします。

削除されたルールは、取り込まれたログイベントをフィルタリングしなくなります。