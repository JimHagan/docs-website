---
title: クラウドコストの最適化
tags:
  - New Relic solutions
  - New Relic solutions
  - Cloud adoption
metaDescription: 'Use New Relic to keep control of your cloud spending costs, and get your teams alerted when you go over your budgets.'
translationType: machine
---

クラウドで運用されているインフラやサービスを利用している場合は、早い段階からクラウドにかかる費用を精査しておくことが重要です。

* クラウドへの支出に関する想定が、期待通りの結果をもたらしているかどうかを確認します。
* 予期せぬ支出の急増を素早くキャッチし、修正することができます。
* クラウドベースのリソースの使用方法の微調整を開始します。

例えば、20台のインスタンスがすべて10%のCPUで動作している場合、より小さなインスタンスを使用したり、より多くの作業をインスタンスに集約したりすることが考えられます。このように、クラウドの利用について考えることで、迅速に最適化し、コストを削減することができます。

New Relic は、これらすべてをモニターすることができます。データの観点から見ると、クラウド利用のデータは、私たちのプラットフォームが収集できる指標のひとつに過ぎません。他の指標と同様に、New Relicが収集を支援する他のデータと同様に、クラウド利用データを可視化し、レポートを作成し、アラートを出すことができます。New Relic は、クラウドへの支出やその他のパフォーマンスデータについての情報を提供します。

## 1.New Relic Infrastructure エージェントを展開します。 [#deploy-infrastructure]

New Relic Infrastructure エージェントの [要件](/docs/infrastructure/new-relic-infrastructure/getting-started/compatibility-requirements-new-relic-infrastructure) を確認し、 [ドキュメント](/docs/infrastructure/new-relic-infrastructure/installation) に従ってエージェントをインストールする手順を確認してください。ホストにInfrastructureエージェントをインストールすると、すぐにエージェントが自動的に受信する広範なメトリクスにアクセスできるようになります。その後、クラウド統合の設定を行い、課金情報の収集を開始することができます。

## 2.クラウド・パフォーマンスのダッシュボード・チャートの作成 [#insights-widgets]

[New Relic Dashboards](/docs/dashboards) は、データに関する強力なカスタムクエリを書き、その結果をダッシュボードに集めたチャートで視覚化するために使用する製品です。また、ダッシュボードのクエリの結果を [New Relic Alerts](/docs/alerts/new-relic-alerts/getting-started/introduction-new-relic-alerts) に直接フィードすることで、指定した偏差値に関する通知を受け取ることができます。

パフォーマンスや使用状況に関連する様々なインフラストラクチャのメトリクスのチャートを含みます。

* CPU
* メモリ
* ディスク
* データベース

また、このクラウドインフラを使用したアプリケーションを表すグラフを掲載することもできます。このようにして、クラウドインフラのパフォーマンスとアプリケーションのパフォーマンスを関連付けることができます。クラウド・インフラの規模を適正化する際には、アプリケーションのパフォーマンスを監視し、目標が達成されているかどうかを確認する必要があります。

## 3.Amazon AWSインテグレーションの設定 [#configure-aws-integration]

New Relic Infrastructure には、 [Amazon Web Services (AWS)](/docs/infrastructure/amazon-integrations/aws-integrations-list) 、 [Microsoft Azure](/docs/integrations/microsoft-azure-integrations/azure-integrations-list) 、 [オンホストの統合](/docs/infrastructure/host-integrations/host-integrations-list) など、いくつかの種類の統合が用意されています。

このチュートリアルは、 [AWS Billingインテグレーション](/docs/integrations/amazon-integrations/aws-integrations-list/aws-billing-monitoring-integration) に焦点を当てています。まず、 [インテグレーション](/docs/integrations/amazon-integrations/getting-started/connect-aws-services-infrastructure) をAWSアカウントで設定し、AWS Billingインテグレーションを設定します。

## 4.AWSでの課金バジェットの設定 [#configure-aws-billing]

Amazon AWS Billingの統合には、AWS側でいくつかの追加設定が必要です。具体的には、AWS Billing ダッシュボードに入り、 **Budgets** を設定する必要があります。当社の [ドキュメント](/docs/integrations/amazon-integrations/aws-integrations-list/aws-billing-monitoring-integration) では、このプロセスのウォークスルーを提供しています。

**Budgets** を作成する際には、以下の点に注意してください。

* アプリケーション名を入力します。
* コストベースの予算編成を行うのか、サービスベースの予算編成を行うのかを決定します。
* あなたの予算がオープンエンドなのか、それとも明確な終了日があるのかを決めてください。

## 5.Insights ダッシュボードにクラウドの支出と予算のウィジェットを追加 [#spend-budget-widgets]

[New Relic Insights](/docs/insights) は、データに関する強力なカスタムクエリを書き、その結果をダッシュボードに集めたウィジェットで視覚化するために使用する製品です。また、Insights のクエリの結果を [New Relic Alerts](/docs/alerts/new-relic-alerts/getting-started/introduction-new-relic-alerts) に直接フィードすることで、指定した偏差値に関する通知を受け取ることができます。

## 6.組織のあらゆるレベルのダッシュボードを作成 [#create-dashboards]

開発者であれ、DevOps担当者であれ、経営者であれ、クラウドへの支出に関する情報があれば、クラウド環境を最適化することができます。

ここでは、組織の各レベルでダッシュボードが役立つ方法をいくつかご紹介します。

<CollapserGroup>
  <Collapser
    id="developers"
    title="開発者向けダッシュボード"
  >
    アプリケーションの実行コストを把握することで、開発者はより効率的なサービスを利用するためにアプリケーションを適切に設定することができます。例えば、開発者はランダムにインスタンスを選択するのではなく、 [Amazon AWS Lambda](https://aws.amazon.com/lambda/) や適切なサイズのインスタンスを使用することで、クラウドのコストを削減できるのではないでしょうか？
  </Collapser>

  <Collapser
    id="dev-ops"
    title="DevOpsのためのDashboards"
  >
    アプリケーションのコストを監視することで、オペレーターはサービスの設定ミスによるオーバーランの可能性をキャッチすることができます。例えば、DevOpsチームのオートスケーリングの設定が適切にスケールダウンされていないか？使用されていないインスタンスにコストをかけていないか？
  </Collapser>

  <Collapser
    id="executives"
    title="役員用ダッシュボード"
  >
    地域ごとに個別のアプリケーションにかかるクラウド費用の予測値と実績値の両方、および総コストを総合的に把握することで、経営陣はより良いビジネス上の意思決定を行うことができます。
  </Collapser>
</CollapserGroup>

New Relic を使用して、クラウドの支出コストを管理し、予算を超過した場合にはチームに警告を出すことができます。

## 7.アラートの設定 [#alerts]

Insightsでデータにクエリを書いたら、それを使って [アラート条件を簡単に作成することができます](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries) 。

New Relic では、データに対してベースラインクエリを書くことができます。ベースラインクエリとは、結果に厳しい制限を設けずに、 [New Relic Applied Intelligence](https://newrelic.com/platform/applied-intelligence) にパフォーマンスデータの「機械学習」をさせるために書くクエリです。ベースラインの数値から大きく外れると、New Relic は警告を発します。

<CollapserGroup>
  <Collapser
    id="configure-baseline-query"
    title="予測値を用いたベースラインクエリの設定"
  >
    予測された金額を使用してベースラインクエリを設定することは、時間の経過とともにクラウドの支出がどのようになるかを理解するために、あらゆるクラウド予算を監視するための素晴らしい出発点となります。予測されたトレンドを超えて何かが急増した場合、New Relic が通知します。そのクエリは次のようなものです。

    ```
    SELECT latest(`provider.forecastedAmount`) FROM FinanceSample WHERE provider = 'BillingBudget' and `provider.budgetName` = '<var>NAME_OF_YOUR_CLOUD_BUDGET</var>'
    ```

    [ベースラインクエリ](/docs/alerts/new-relic-alerts/defining-conditions/create-baseline-alert-conditions) を作成し、それに基づいてアラートを出す場合、Applied Intelligenceがデータをどの程度制限して分析するかを、最近のパフォーマンスに基づいてシンプルなスライダーと視覚化で決定します。スライダーは、予算のしきい値（青い線）の周りのグレーの帯を増減させます。

    ![NRQLアラート条件](./images/NRQL-Alert.png "NRQLアラート条件")

    <figcaption>
      [**alerts.newrelic.com**](https://alerts.newrelic.com) **> アラートポリシー> （ポリシーを選択）> アラート条件：** NRQL クエリと Insights データに基づいてアラート条件を作成します。
    </figcaption>

    この例では、最近のデータに基づけば違反はゼロであり、それこそが求められていることです。しかし、この青い線がグレーの帯から急上昇した場合、New Relicはあなたに通知します。
  </Collapser>
</CollapserGroup>

アラートの作成、管理、使用に関する詳細な情報は、New Relic Universityのチュートリアルをご覧ください。

* [アラーティングの概要](https://learn.newrelic.com/courses/performance_tools/alerts)
* [アラートポリシー](https://learn.newrelic.com/courses/performance_tools/alert_policies)
* [アラートインシデントのライフサイクル](https://learn.newrelic.com/courses/performance_tools/alerting_lifecycle)
* [通知チャネル](https://learn.newrelic.com/courses/performance_tools/alert_notification)